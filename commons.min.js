var Settings=function(){this.appName="Would you Rather";this.appPath=location.host;if(!this.appPath){this.appPath="wouldyourather.co"}else{if(location.hostname==="localhost"||location.hostname==="127.0.0.1"){var a=location.pathname.split("/~")[0].split("/");a.pop();this.appPath=location.host+a.join("/")}}this.urlPath="http://"+this.appPath;this.corePath=this.urlPath+"/core/";this.keysPath=this.urlPath+"/core/data/";this.app_package="at.wouldyourather";this.androidURL="https://play.google.com/store/apps/details?id="+this.app_package;this.iosURL="";this.loadSharedUrl(this.appPath)};Settings.prototype.loadSharedUrl=function(a){var b=a.split("www.");this.sharePath=b[b.length-1]};function showVotation(g){$("#mainPage > div").hide();$("#votation").show();window.screenPoll.buttons=new VotationButtons(screenPoll);window.screenPoll.buttons.init();$("#send").hide();var c=screenPoll.style;if(c&&c.extraValues){for(var b=0;b<c.extraValues.length;b++){if("nm"==c.extraValues[b]){var d=2+b;var f=false;if(g){for(var e in g){var a=g[e];if(a[d]&&(a[1]||0===a[1])){console.log("some name exists: "+a[d]+" , "+a[1]);f=true;break}}}if(!f){console.log("any 'nm' in obj.users - disable button");$("#usersButton").addClass("disabled")}break}}}$("#send").removeAttr("disabled")}function backVotation(){$("#mainPage > div").hide();$("#votation").show();$("#buttons").show()}function saveDefaultValues(a){window.originalPublic=$("#p_makePublic input").is(":checked");window.originalCountry=$("#countrySelect select").val()}function AskUserName(){var g=this;var f=null;var e=screenPoll.obj;if(e.users&&e.users[user.id]){f=e.users[user.id][1]}var a="";if(window.user&&user.nm){var b=decode_uri(user.nm);a="value='"+b+"'"}else{var c=localStorage.getItem("userName");if(c){a="value='"+c+"'"}}$("#userNamePoll").remove();var d=$("<div id='modal_background'><input id='userNamePoll' type='text' data-placeholder='myName' "+a+" /></div>");$("#votationButtons").prepend(d);if(screenPoll.isPublic){g.no_requiredName()}$(document).on("public",function(){g.no_requiredName()});$(document).on("private",function(){g.requiredName()})}AskUserName.prototype.requiredName=function(){$("#modal_input").removeClass("hideHeight");$("#send").off(".requiredName");$("#send").on("click.requiredName",function(b){var a=screenPoll.obj.users[user.id][1];if(!$("#userNamePoll").val()&&(a||0===a)){$("#userNamePoll").focus()}})};AskUserName.prototype.no_requiredName=function(){$("#modal_input").addClass("hideHeight");$("#send").off(".requiredName")};var votationEvents_deviceShare=function(b,c,a){if(!a){a=""}return Device.share(b.substring(22),c,a)};var ShareIntent=function(){this.log_div_query="#errorLog";localStorage.setItem("not_installed","");localStorage.setItem("app","")};ShareIntent.prototype.checkShareEnvirontment=function(b,d){if(window.isAndroid){console.log(b);this.intent(b,d)}else{if(window.iPhone){console.log("iPhone ShareIntent.checkShareEnvirontment");$("#linksLink").remove();var c=$("<div id='linksLink' class='clickable' style='margin: 7px 0 20px 10px;'>"+transl("downloadAppStore")+"<a href='"+settings.iosURL+"' id=links class='hide' style='margin-top:5px;'><img src='~commons/img/appstore_comming.png' style='max-width:200px; opacity:0.7'/></a></div>");$(this.log_div_query).append(c);$(this.log_div_query).show();c.click(function(){$(document).off(".links");$("#links").toggleClass("hide");setTimeout(function(){$(document).one("click.links",function(a){if(!$(a.target).closest("#links").length&&$(a.target).attr("id")!="links"){$("#links").addClass("hide")}})},1)})}else{console.log("!checkShareEnvirontment")}}};ShareIntent.prototype.intent=function(a,b){var c=this;if(this.notAskAppIntent){console.log("notAskAppIntent");return}console.log("intent init");a.on("click.intent",function(){var e="";if(b){for(var i=0;i<b.length;i++){var h=b[i][2];var g=a.closest(".option");if(g.length){var d=g.attr("class").split("_")[1];if(d==i){h++}}e+="_"+h}}$("body").addClass("no_image");var f=c.getUrl(e);if(!f){return}window.open(f);setTimeout(function(){var k=localStorage.getItem("not_installed");var m=localStorage.getItem("app");console.log("not_installed: '"+k+"', app: '"+m+"'");if(k&&!m){c.askAppInstall()}else{if(m){var l=0;var j=setInterval(function(){k=localStorage.getItem("not_installed");if(k){clearTimeout(j);c.disableIntent("not_installed interval")}if(l>20){clearTimeout(j)}l++},500)}else{c.getUrl=function(n){var o="intent://"+location.host+"/share"+n+location.pathname+"#Intent;scheme=http;package="+settings.app_package+";end";console.log("intent "+o);return o}}}},2500)})};ShareIntent.prototype.getUrl=function(a){if(this.shareCheckCalled){console.log("getUrl already called");return false}this.shareCheckCalled=true;var b="http://share."+location.host+"#"+a+location.pathname;if("localhost"==location.hostname){var c=location.pathname.split("/");c.pop();b=location.origin+c.join("/")+"/~share#"+a+location.pathname}return b};ShareIntent.prototype.askAppInstall=function(){var b=this;var a="";if(window.isAndroid){a=settings.androidURL}if(window.iPhone){a=settings.iosURL}if(a){modalBox("Usa la app para compartir la encuesta!","Desc√°rgala completamente gratis. <br>No requiere de permisos especiales",function(){window.open(a,"_blank")},function(){b.disableIntent("from modalBox")})}else{this.disableIntent("!link")}};ShareIntent.prototype.disableIntent=function(a){$("*").off(".intent");console.log("disableIntent(): "+a);$(".no_image").removeClass("no_image");this.notAskAppIntent=true};var VotationButtons=function(d,a,b){this.poll=d;this.$imageDOM=$("#mainPage");this.savingPoll=false;this.key_waiting=0;this._ajaxKeyWaiting=0;this.$sendButton=$("<button id='send' class='share'><em></em><span data-lang='Share'></span></button>");this.$cancelButton=$("<button id='cancel' data-lang='Cancel'>");this.$usersButton=$("<button id='usersButton' data-lang='Voters'>");if(!a){a=$("#buttons");this.$votation=$("#creator")}else{this.$votation=a.parent()}this.$dom=a;a.find(".votationButtons").remove();var e=$("<div class='votationButtons'>");e.prepend(this.$usersButton);var c=$("<div id='defaultButtons'>");c.append(this.$sendButton);c.append(this.$cancelButton);e.prepend(c);a.append(e);loadTranslations()};VotationButtons.prototype.init=function(){this.sendButtonEvent();this.cancelButtonEvent();this.usersButtonEvent()};VotationButtons.prototype.sendButtonEvent=function(){var a=this;console.log("VotationButtons.sendButtonEvent original");this.$sendButton.click(function(c){c.stopPropagation();$("body").append("<img from='VotationButtons.sendButtonEvent' class='loading absoluteLoading' src='~img/loader.gif'/>");var b=a.poll.obj;if(a.$sendButton.hasClass("saveAndShare")){if(!b.users){b.users=[]}b.users[a.user.id]=getUserArray(a.user);a.save("create",function(d){if(false===d){$(".absoluteLoading").remove();return}localStorage.setItem("unusedKey","")})}else{if(!a.$sendButton.hasClass("share")){a.$sendButton.attr("disabled","disabled");a.save("update",function(d){$(".absoluteLoading").remove();if(false!==d){saveToShare()}})}else{a.share(function(){$(".absoluteLoading").remove()})}}})};VotationButtons.prototype.cancelButtonEvent=function(){this.$cancelButton.click(function(){window.screenPoll=new LoadedPoll();if(window.isTranslucent){if(Device.close){console.log("closing.. window.isTranslucent: "+window.isTranslucent);Device.close("cancelButton window.isTranslucent");return}}if(window.keyLinkPage){if(document.referrer.indexOf(window.location.host)>-1||true){window.history.back();if(history.length<=1&&Device.close){console.log("no history close");Device.close("window.keyLinkPage & history.length <= 1")}}else{hashManager.update("polls")}}else{hashManager.update("")}$(document).off(".swipePrevent")})};VotationButtons.prototype.usersButtonEvent=function(){var j=this;var f=this.poll.obj;var c=f.users;var l;if(f.style&&f.style.extraValues){for(var g=0;g<f.style.extraValues.length;g++){if("nm"==f.style.extraValues[g]){l=2+g;break}}}var b=0;var k=[];for(var d in c){var e=c[d];var h=e[1];if(!h&&0!==h){continue}var a=e[l];if(!a||(!e[1]&&0!==e[1])){b++;continue}k.push(e)}if(k.length<2){this.$usersButton.hide();return}this.$usersButton.click(function(){$("#users .list").html("");var o=[];for(var t in k){o.push(k[t])}o.sort(function(u,i){return u[l].localeCompare(i[l])});for(var q=0;q<o.length;q++){var n=o[q];var t=n[0];var s=n[l+1];var p="<div id='user_"+t+"'> <div class='left'><div class='usr'>"+decode_uri(a);if(s){if("_"==s[0]){s=transl(s.substr(1))}p+=" <small style='color: rgba(0,0,0,0.3)'>("+s+")</small>"}p+="</div></div>";if(f.style.openVotes){p+="<div class='right'><span>"+f.options[n[1]]+"</span></div>"}p+="</div>";var r=$(p);$("#users .list").append(r)}var m=$("#users .list > div").length;if(m){if(b){var r=$("<tr><td>(and "+b+" "+transl("unknown")+")</td></tr>");$("#users table").append(r)}j.$imageDOM.find("> div").hide();j.$usersButton.show()}else{flash(transl("notPublicUsers"))}})};VotationButtons.prototype.share=function(h){var d=this;var e=this.poll;console.log(e);var c=arguments;if(!$("#shareButtonLoading").length){$("body").append("<img from='VotationButtons.share' id='shareButtonLoading' class='loading absoluteLoading' src='~img/loader.gif'/>")}console.log("VotationButtons.share");if(!Device.share&&!e.key){if(this._ajaxKeyWaiting>10){this._ajaxKeyWaiting=0;error("missingAjaxKey");if(h){h(false)}return}this._ajaxKeyWaiting++;setTimeout(function(){console.log("waiting ajax key..");d.share.apply(this,c)},700);return}this._ajaxKeyWaiting=0;console.log("country = "+e.country);var i=e.key;var g="#image .image";$("#image").remove();var a=$("<div id='image'><hr/><div class='image'></div></div>");this.$imageDOM.append(a);var f="";if($(e.divQuery).hasClass("show")){f="show"}var b=null;getCanvasImage(g,e.obj,i,b,f,function(k){if(!k){error("!imgData on getCanvasImage");return}if(Device.share){a.hide();var j="";if(window.language){j=language.shareUrl+"/"}votationEvents_deviceShare(k,i,j)}else{$("#stored").addClass("hidden");a.show()}if(h){h(true)}});console.log("poll.json: "+e.json);saveLocally(i,e.json)};VotationButtons.prototype.save=function(a,j){var d=this;console.log("VotationButtons.save screenPoll");var g=this.poll;var b=window.user;if(!g.isPublic){var e=$("#userNamePoll").val()||localStorage.getItem("userName");if(e){if(!b){b={}}b.nm=e;if(window.Device){if(window.isAndroid){b.from="android"}else{b.from="device"}}else{b.from=browser()}updateUserName(e)}else{var h=localStorage.getItem("userName");modalInput(transl("myName"),h,function(k){updateUserName(k);d.save(a,j)});if(j){j(false)}return}}if(!this.savingPoll){if($(".absoluteLoading").length){$(".absoluteLoading").attr("from","VotationButtons.save")}else{$("body").append("<img from='VotationButtons.save' class='loading absoluteLoading' src='~img/loader.gif'/>")}this.savingPoll=true}console.log("saving key: '"+g.key+"'");if(window.Device&&g.key){if("_"==g.key[0]){notice(g.key)}else{if(!g.key[0]=="-"){console.log("not private key: "+g.key);if(!window.publicId){this.notSave(2);console.log("ASKING PHONE "+g.key);askPhone();if(j){j(false)}return}g.isPublic("true");if(window.phoneId&&g.obj.users[phoneId]){delete g.obj.users[phoneId]}}}}var c="";if("update"==a){console.log('update" == action');var f=g.obj.users[b.id];c=CSV.stringify([f]);g.json+="\n"+c;saveLocally(g.key,g.json)}else{if("create"==a){c=g.json=pollToCSV(g.obj)}else{console.log("error on action: "+a);if(j){j(false)}return}}if(this.lastSendJson==c){d.saveCallback(this.poll.key);return}this.lastSendJson=c;$("#image").remove();var i=g.obj.users[b.id][1];saveDefaultValues(i);this.saveEventCallback=j;if(!Device.save){this.saveAjax(a,c,function(k){d.saveCallback(k)})}else{this.saveDevice(a,"screenPoll.buttons.saveCallback")}};VotationButtons.prototype.saveCallback=function(c){console.log("saveCallback "+c);this.poll.key=c;if(this.poll.key){var d=getPathsFromKeyId(this.poll.key);var b=d.realPath+d.realKey;var a=(new Date()).getTime()+86400000;localStorage.setItem(b,a);if(this.saveEventCallback){this.saveEventCallback()}}if(this.$sendButton.hasClass("saveAndShare")){this.share(function(){$(".absoluteLoading").remove();this.savingPoll=false})}else{$(".absoluteLoading").remove();this.savingPoll=false}};VotationButtons.prototype.notSave=function(a){console.log("VotationButtons.notSave: "+a);this.$sendButton.removeAttr("disabled")};VotationButtons.prototype.saveToShare=function(){if(this.$sendButton.hasClass("saveAndShare")){return}if(!this.$sendButton.hasClass("share")&&!$("#send").hasClass("saveAndShare")){this.$sendButton.removeAttr("disabled")}this.$sendButton.attr("class","share");this.$sendButton.find("span").text(lang.Share);$("#publicMessage").hide()};VotationButtons.prototype.shareToSave=function(){if(this.$sendButton.hasClass("saveAndShare")){return}this.$sendButton.removeAttr("disabled");this.$sendButton.removeClass();this.$sendButton.find("span").text(transl("Save"))};function newKeyConnectionError(){if(window.checkConnection()){flash("retrieve key error")}}NewVotation_newKeyAjax=function(c){var b=null;var a=null;console.log("update.php request: newkey, "+window.user.id);$.ajax({beforeSend:function(e,d){b=e},url:settings.corePath+"update.php",method:"POST",cache:false,data:{action:"newkey",id:window.user.id}}).done(function(d){console.log("NewVotation_newKeyAjax: "+d);loadKey(d)}).error(function(d){console.log(d);console.log("new key error !!")}).complete(function(){clearInterval(a)});a=setInterval(function(){console.log("5s TIMEOUT");if(!window.checkConnection){b.abort()}},5000)};var LoadKeyPoll=function(b){console.log("LoadKeyPoll "+b.key);$("html").addClass("loadKeyPoll");this.poll=window.screenPoll=b;this.key=this.poll.key;loading();var a=b.key.indexOf("-")>0;if((b.key[0]!="-"||a)&&b.key.indexOf("_")==-1){b.isPublic("true");if(a){b.country=b.key.split("-").shift()}}else{}this.requestPollByKey()};LoadKeyPoll.prototype.requestPollByKey=function(){var b=this.key;console.log("requestPollByKey "+b);var e=getPathsFromKeyId(b);var c=e.realPath;this.poll.realKey=e.realKey;var a=c+this.poll.realKey;var d="";if("public"==e.visible){a=settings.keysPath+"get.php";d="url=public/"+e.countryPath+this.poll.realKey}if("private"==e.visible||"public"==e.visible){console.log("url: "+c+" + "+this.poll.realKey);if(Device.simpleRequest){Device.simpleRequest(a,d,"new RequestPollByKeyCallback")}else{loadAjaxKey(a,d,function(f){new RequestPollByKeyCallback(f)})}}};function loadAjaxKey(b,d,e,a){console.log("url: "+b+" on loadAjaxKey()");var c=new XMLHttpRequest();if(!a){d+="nocache="+(new Date()).getTime()}c.open("POST",b);c.onreadystatechange=function(){if(c.readyState===4){if(c.status===200){e(c.responseText)}else{console.log("Error "+c.status+" occurred uploading your file.");e(false)}}};c.overrideMimeType("text/plain; charset=ISO-8859-1");c.send(d)}var RequestPollByKeyCallback=function(a){var b=this;this.data=a;this.query="#votation .votationBox";console.log(a);this.user=window.user;this.poll=window.screenPoll;if(!this.poll){this.poll=new LoadedPoll()}$("#errorLog").html("");if(!a){if(alternative.keysPath&&settings.keysPath!=alternative.keysPath){settings.keysPath=alternative.keysPath;console.log("requestPollByKey again");new requestPollByKey();return}error("votationNotFound");error("e_noDataReceived");hashManager.defaultPage();return}if(a[0]=="_"){error(a)}this.parseUserVotes(function(c){if(!window.isAndroid){noticeBrowser();if("true"==b.poll.isPublic){disableVotation();noticePublic()}}showVotation(c.users);b.user=b.getUser(c);var d=b.poll.key;b.checkCountry(d)})};RequestPollByKeyCallback.prototype.parseUserVotes=function(h){var d=this.data;var c=this.poll.obj=parseData(d);this.poll.json=d;saveLocally(this.poll.key,this.poll.json);if(!this.poll.obj){console.log("error parsing object: "+this.poll.json);errorParse("e_votationWithErrors");return}console.log("parseUserVotes newUser "+window.user.id);var b=this.getUser(c);saveDefaultValues(b.vt);this.user=b;$("#votationOwner").remove();if(c.style&&!empty(c.style.owner)){var k=$("<div id='votationOwner'><span class='by'>by: </span></div>");var j=c.style.owner;j=decode_uri(j);var f=j.split(" ");for(var e=0;e<f.length;e++){if(isUrl(f[e])){var a=f[e];if(a.indexOf("http")==-1){a="http://"+f[e]}f[e]="<a href='"+a+"'>"+f[e]+"</a> ";k.append(f[e]);continue}var g=$("<span>");g.text(f[e]+" ");k.append(g)}$("#votation").prepend(k)}window.loadedTable=new FillTable(this.query,c);h(c)};RequestPollByKeyCallback.prototype.getUser=function(f){var e=this.user.id;if(!f.users){f.users={}}if(!f.users[e]){f.users[e]=getUserArray()}var a=f.users[e];if(!a){throw"user = "+JSON.stringify(a)}var b={id:e,vt:a[1]};if(f.style&&f.style.extraValues){for(var d=0;d<f.style.extraValues.length;d++){var c=f.style.extraValues[d];b[c]=a[2+d]}}console.log(b);return b};RequestPollByKeyCallback.prototype.checkCountry=function(c){if(c[0]=="-"){return}var b=c.split("-").shift();if(b){var a=getCountryName(b.toUpperCase(),getUserLang());if(!isUserCountry(b)){if("undefined"!=typeof publicId&&publicId){disableVotation();notice(transl("WrongCountry")+a+".")}}else{if($("#linksLink").html()==""){notice(lang.PollOnlyAvailableIn+a+".")}}}};function errorParse(a){console.log("errorParse "+$("html").hasClass("translucent").toString());if(Device.close&&$("html").hasClass("translucent")){$(".loading").remove();flash(transl(a),null,function(){Device.close("errorParse "+a)});return}hashManager.update("home",a)}function disableVotation(){$("#votation .votationBox").addClass("unClickable")}VotationButtons.prototype.saveAjax=function(b,a,c){if("true"==this.poll.isPublic){error("PublicOnlyFromApp");return}$.ajax({url:settings.corePath+"update.php",method:"POST",cache:false,data:{action:b,id:window.user.id,key:this.poll.key,value:a}}).done(function(d){console.log(d);if(!d){error("errorAjaxResponse");return}if(c){c(d)}}).error(function(d){console.log(d);console.log("can't connect with ajax");error("votationNotSaved");saveToShare();this.poll.key=" "})};VotationButtons.prototype.saveDevice=function(d,h){var e=this;var i=this.poll.json;var f=""+this.poll.isPublic;var c=this.poll.country;var g=this.poll.key;if(!this.keyWaiting){this.keyWaiting=0}if(!g&&!f&&"create"==d){if(this.keyWaiting>8){flash(transl("waitingKeyExpired"));return}setTimeout(function(){e.saveDevice(d,h)},700);console.log("looking for new key");this.keyWaiting++;return}this.keyWaiting=0;var b="";if(g){var a=getPathsFromKeyId(g);b=this.poll.realKey=a.realKey}if(!window.lastKeyAsk){window.lastKeyAsk=0}console.log("callback: "+h);Device.save(d,i,window.lastKeyAsk,b,f,c,h)};function saveLocally(a,b){if(a){var c=(new Date()).getTime();localStorage.setItem("key_"+a,JSON.stringify([c,b]))}else{console.log("WRONG KEY TO STORE: "+a)}}var User=function(a,b){console.log("new User()");if(!window.Device){this.userIP(function(c){if(b){b(c)}})}else{if(!this.id&&window.user){this.id=window.user.id}if(b){b(this)}}};User.prototype.userIP=function(b){var a=this;console.log("addUserIP: "+window.userIp);if(window.userIp){this.id=window.userIp;if(b){b(this)}return}$.ajax({url:settings.corePath+"getIP.php"}).success(function(c){console.log(c);var d=null;try{d=JSON.parse(c)}catch(f){console.log("wrong ip data");return}var h=localStorage.getItem("userId");if(!h){h=d[0]}var g=d[1];localStorage.setItem("userId",h);a.id=h;a.country=g;if(b){b(a)}window.userIp=h}).error(function(){console.log("getIP.php not found");var c="local";localStorage.setItem("userId",c);a.id=c;if(b){b(a)}})};function getUserLang(){var a=localStorage.getItem("userLang");if(a){return a}var b=navigator.language||navigator.userLanguage;return b.split("-")[0]}function isUserCountry(c){var b=false;if(!window.userCountryArray){return false}for(var a=0;a<userCountryArray.length;a++){if(userCountryArray[a].toUpperCase()==c.toUpperCase()){b=true;break}}return b}function addUser(c,b){console.log("addUser start '"+c+"'");if(!c){console.log("not valid id");return}updateUserId(c);var a=localStorage.getItem("userName");updateUserName(a);if(b){userCountry=b;localStorage.setItem("userCountry",userCountry)}else{userCountry=navigator.language||navigator.userLanguage;if(userCountry.indexOf("-")!=-1){userCountry=userCountry.split("-").pop()}}}function updateUserId(a){if(!window.user){window.user=new User()}window.user.id=a;localStorage.setItem("userId",a)}function updateUserName(a){if(!window.user){window.user=new User()}window.user.nm=a;localStorage.setItem("userName",a);$("#username input").val(a)}storedPolls_init();$(document).ready(function(){for(var a in localStorage){var b=a.split("key_");if(b.length==2&&b[1]){console.log("exists stored polls");return}}console.log("hide #showPolls");$("#showPolls").hide()});function loadStoredPolls(){var g=$("#stored .list");g.html("");for(var b in localStorage){var d=b.split("key_");if(d.length!=2||b.indexOf(" ")!=-1){continue}try{$(b).length}catch(i){console.log("ERROR stored key: "+b);continue}console.log("storedKey = '"+b+"'");var k=d[1];var h;try{h=JSON.parse(localStorage[b])}catch(i){console.log("can't parse "+b);continue}var c="stored_"+k.replace(/([^\w\s])/g,"$1");var a=$("<div class='votation' id='"+c+"'>");var j="#"+c;var f=parseData(h[1]);console.log(f);if(!f){$(j+" .loader").text(lang.error);localStorage.removeItem(b);continue}g.append(a);window.storedTable=new FillTable(j,f,{removable:true});StoredPolls._events(k);StoredPolls._loadWebPoll(k);fontSize(j)}}function storedPolls_init(){window.StoredPolls={};StoredPolls._loadWebPoll=function(f){var e=this;console.log("StoredPolls._loadWebPoll");var d=getPathsFromKeyId(f);var c=d.realPath;var b=d.realKey;var a=true;loadAjaxKey(c+b,"",function(h){var g="#stored_"+f;$("#stored_"+f+" .loader").hide();if(!h){console.log("error retrieving data");var j=$(g);j.off(".poll");j.removeClass("votation clickable");j.off("click");j.css("opacity",0.5);j.prepend("<small class='error'>"+transl("e_retrievingData")+"</small>");return}saveLocally(f,h);var i=parseData(h,true);window.storedTable=new FillTable(g,i,{removable:true});e._events(f);$(g+" .loader").hide();fontSize(g)},a)};StoredPolls._events=function(f){var e=this;var d="#stored_"+f;var b=$(d+" .stored");var a=$(d+" .removeInfo");var c=true;b.on("mousemove",function(){if(c&&!b.find(".close").length){var g=$("<div class='close' style='position:absolute; top:-3px; right:-7px; width: 20px; height: 20px; background:red; border-radius:99px; border: 1px solid gainsboro; text-align:center; line-height:18px;'>x</div>");b.append(g);g.click(function(h){h.stopPropagation();e._remove(b)})}b.one("mouseleave",function(){b.find(".close").remove()})});b.on("mousedown touchstart",function(l){l.stopPropagation();console.log("touchstart");l=getEvent(l);var g=b.width();var k=l.clientX;var j=l.clientY;var h,m,i=0;$(document).on("mousemove.stored touchmove.stored",function(n){c=false;n=getEvent(n);h=n.clientX-k;m=n.clientY-j;if(h>10&&Math.abs(h)>Math.abs(m)){h=h-Math.abs(m);i=h/g;b.css({"-webkit-transform":"translateX("+h+"px)","-ms-transform":"translateX("+h+"px)",transform:"translateX("+h+"px)",opacity:1-i});if(i>0.4){a.css("color","red")}else{a.css("color","grey")}$(d).removeClass("clickable")}else{b.css({"-webkit-transform":"translateX(0)","-ms-transform":"translateX(0)",transform:"translateX(0)",opacity:1})}});$(document).one("mouseup.stored touchend.stored",function(n){c=true;$(document).off(".stored");if(i>0.4){e._remove(b)}else{b.css({"-webkit-transform":"translateX(0)","-ms-transform":"translateX(0)",transform:"translateX(0)",opacity:1})}setTimeout(function(){$(d).addClass("clickable")},1)})});clickablePoll(d,f)};StoredPolls._remove=function(a){a.animate({opacity:0,left:a.width()},300,function(){a.css("transform","translateX(0)");var c=a.parent();console.log("StoredPolls._remove");c.removeClass("clickable");c.find(".undo").remove();var b=$("<div class='undo' class='hoverUnderline'>"+lang.UNDO+"</div>");c.append(b);$(document).off(".undo");$(document).one("mousedown.undo touchstart.undo",function(f){f.preventDefault();if($(f.target).hasClass("undo")){$("#stored .undo").remove();$("#stored .stored").animate({left:0,opacity:1,},300);$("#stored .stored").addClass("clickable")}else{var g=$("#stored .undo");for(var d=0;d<g.length;d++){(function(){var e=$(g[d]).parent();var h=e.attr("id").split("_")[1];localStorage.removeItem("key_"+h);setTimeout(function(){e.remove()},300)})()}}})})}}function HashManager(){var a=this;$(window).on("hashchange",function(){console.log("hashchange");a.load(location.hash)});this.list={"new":function(){newPoll()},firstTime:function(){$("#mainPage > div").hide();$("#firstTime").show()},home:function(){console.log("HOME");window.screenPoll.buttons=new VotationButtons(screenPoll);window.screenPoll.buttons.init();$("#cancel, #usersButton").hide();$("#pollsHeader").hide();$("#voteHeader").show();$("#mainPage > div").hide();$("#creator").show();$("#buttons").show();$("#showPolls").show();$("#stored").show();a.newPollView()}};$(document).ready(function(){if(!screenPoll.key){if(location.hash){console.log("lodHash() without key");a.loadHashData()}else{console.log("!key and !location.hash");a.defaultPage()}}})}HashManager.prototype.newPollView=function(){console.log("newPollView");if($("#body").hasClass("pollsView")){$("#body").removeClass("pollsView");$("#pollsHeader").hide();$("#voteHeader").show();$("#body").addClass("swiping");setTimeout(function(){$("#body").removeClass("swiping")},1)}};HashManager.prototype.update=function(b,a){console.log("loadHash: "+b+" : "+a);$(".loading").remove();$(".loadKeyPoll").removeClass("loadKeyPoll");$(document).trigger("urlUpdate",[b]);if(!b){b=""}b=b.replace("#","");if(!a){a=""}else{a="?"+a}if(!window.Device){if(location.hash=="#"+b+a){this.load(b)}else{location.href=location.origin+location.pathname+"#"+b+a}}else{if(location.search){location=location.origin+location.pathname+"#"+b+a;return}if(location.hash=="#"+b+a){this.load(b);return}location.hash=b}};HashManager.prototype.load=function(b){b=b.replace("#","").split("?")[0];console.log("hash changed to: "+b);if(!b){b="home"}if(b.search(/^key=/i)>-1){screenPoll.key=b.split("=")[1];window.keyPoll=new LoadKeyPoll(screenPoll)}else{console.log(this);console.log(b);if(this.list[b]){this.list[b]()}}var a=b.split("?");if(a.length>1){notice(transl(a[1]))}};HashManager.prototype.loadHashData=function(){console.log("loadHashData of: "+location.hash);var a=location.hash.split("#")[1];if(a&&window[a]){window[a]()}else{this.load(location.hash);console.log(a+"() was not a function -> hashChanged()")}};HashManager.prototype.defaultPage=function(){this.update("home");$("html").removeClass("translucent")};HashManager.prototype.resume=function(){stopFlash();if($("#loading:visible").length&&!$("html").hasClass("translucent")){this.defaultPage()}$("#send").removeAttr("disabled")};var alternative={};var userLanguage=window.navigator.userLanguage||window.navigator.language;function getEvent(a){if(!a){return}if(a.originalEvent.touches){return a.originalEvent.touches[0]}else{return a}}function getPathsFromKeyId(i){console.log("getPathsFromKeyId "+i);if(!i){i=location.pathname.split("/").pop();if(!i||i.indexOf(".")!==-1||location.href.indexOf("/share")>-1){return false}}var j=settings.keysPath;var g="false";var b="-";var a="private";var e;var c="";var h=i;if(i.indexOf("-")>0){g="true";a="public";var d=i.split("-");e=d.shift();c="~"+e+"/";j+=c;h=d.join("-")}if(i.indexOf("_")>-1){b="_";a="";var d=i.split("_");e=d.shift();h=d.join("_")}screenPoll.isPublic(g);if(a=="public"||a=="private"){j+=a+"/"}var f={realPath:j,realKey:h,keyId:i,symbol:b,visible:a,prefix:e,countryPath:c};return f}function getPathsFromRealKey(b,c,e){var d=settings.appPath+"/";var f=b;if(c){d+="public/"}else{d+="private/"}if(e){d+="~"+e.toLowerCase()+"/";f=e.toLowerCase()+"-"+b}var a={realPath:d,keyId:f,key:b};return a}function transl(a){if(!window.lang){return a}var b=lang[a];if(!b){b=a}return b}function getCountryArray(c){if(window.userCountryArray){c();return}var a=[];if(window.userCountry){a=window.userCountry.split(new RegExp("&| ","g"))}var a=a.filter(function(d){return typeof d!="undefined"});var b=a[a.length-1];if(b){b=b.toUpperCase()}$.getJSON(settings.urlPath+"/core/orgs.json",function(e){for(var g in e){var f=e[g];for(var d in f){if(b==d){a.push(g)}}}window.userCountryArray=a;c()})}function formatNumber(c){var b=(""+c).split("").reverse().join("");var d="";for(var a=0;a<b.length;a++){if(a%3==0&&a!=0){d+="."}d+=b[a]}return d.split("").reverse().join("")}function isEmpty(a){for(var b in a){if(a.hasOwnProperty(b)){return false}}return true}function checkConnection(){if(!navigator.onLine){flash(transl("e_connection"));return false}return true}function getUrlCache(a){var b=localStorage.getItem(a);if(b){if(b>(new Date()).getTime()){return(new Date()).getTime()/60000|0}localStorage.removeItem(a)}return((new Date()).getTime()/86400000)|0}function isUrl(a){var c="^((https|http)://|)([0-9a-z_]*\\.)*([0-9a-z-]{0,61}\\.[a-z]{2,6})(:[0-9]{1,4}|)([/?#]([0-9a-z/-[\\]._~:?#@!$&'()*+,;=%]*)|)$";var b=new RegExp(c);return b.test(a)}function getBackgroundSize(b){var k=getComputedStyle(b),c=new Image(),a=k.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),f=k.backgroundSize,d=parseInt(k.width.replace("px",""),10),l=parseInt(k.height.replace("px",""),10),e=[d,l],h=[],j;c.src=a;j=c.width>c.height?c.width/c.height:c.height/c.width;f=f.split(" ");h[0]=f[0];h[1]=f.length>1?f[1]:"auto";if(f[0]==="cover"){if(e[0]>e[1]){if(e[0]/e[1]>=j){h[0]=e[0];h[1]="auto"}else{h[0]="auto";h[1]=e[1]}}else{h[0]="auto";h[1]=e[1]}}else{if(f[0]==="contain"){if(e[0]<e[1]){h[0]=e[0];h[1]="auto"}else{if(e[0]/e[1]>=j){h[0]="auto";h[1]=e[1]}else{h[1]="auto";h[0]=e[0]}}}else{for(var g=f.length;g--;){if(f[g].indexOf("px")>-1){h[g]=f[g].replace("px","")}else{if(f[g].indexOf("%")>-1){h[g]=e[g]*(f[g].replace("%","")/100)}}}}}if(h[0]==="auto"&&h[1]==="auto"){h[0]=c.width;h[1]=c.height}else{j=h[0]==="auto"?c.height/h[1]:c.width/h[0];h[0]=h[0]==="auto"?c.width/j:h[0];h[1]=h[1]==="auto"?c.height/j:h[1]}return{width:h[0],height:h[1]}}function encode_uri(a){return unescape(encodeURIComponent(a))}function decode_uri(a){try{a=decodeURIComponent(escape(a))}catch(b){}return a}function browser(){var b=navigator.userAgent,a,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(c[1])){a=/\brv[ :]+(\d+)/g.exec(b)||[];return"IE "+(a[1]||"")}if(c[1]==="Chrome"){a=b.match(/\b(OPR|Edge)\/(\d+)/);if(a!=null){return a.slice(1).join(" ").replace("OPR","Opera")}}c=c[2]?[c[1]]:[navigator.appName];if((a=b.match(/version\/(\d+)/i))!=null){c.splice(1,1,a[1])}return c[0].toLowerCase()}$(window).on("swipe",function(){console.log("SWIPE");is_touch_device("true")});function is_touch_device(a){if(a){localStorage.setItem("touch",a);return}var b=localStorage.getItem("touch");if(!b||"false"==b||"undefined"==b){b=false}return b}function disableScroll(){$("*").on("touchmove.disableScroll",function(a){a.preventDefault()})}function enableScroll(){$("*").off(".disableScroll")}function empty(a){if(!a||"null"==a||"undefined"==a){return true}return false}var CSV={delimiter:"|",stringify:function(a){var c=this.delimiter;var d=[];a.forEach(function(h,g){var f;try{f=h.join(c)}catch(i){console.log("can't join:");console.log(h);f=h.join(c)}d.push(f)});var b=d.join("\n");console.log("csv stringify: "+b);return b},parse:function(g){var c=[];var a=g.split(/\n|\\n/);var f=a[0].split(this.delimiter);c.push(f[0]);try{c.push(JSON.parse(f[1]));c.push(JSON.parse(f[2]))}catch(d){console.log("can't parse "+f[1]+"and "+f[2]);return false}for(var b=1;b<a.length;b++){c.push(a[b].split(this.delimiter))}return c}};function getCookie(c){var b=document.cookie;var e=c+"=";var d=b.indexOf("; "+e);if(d==-1){d=b.indexOf(e);if(d!=0){return null}}else{d+=2;var a=document.cookie.indexOf(";",d);if(a==-1){a=b.length}}return decodeURI(b.substring(d+e.length,a))}var canvas,ctx;function getUserArray(b){if(empty(b)){console.log("["+window.user.id+", '']");return[window.user.id,""]}console.log("user: '"+b+"'");var a=[b.id,b.vt];var e=screenPoll.style;if(e&&e.extraValues){for(var d=0;d<e.extraValues.length;d++){var c=e.extraValues[d];if(b[c]){a.push(b[c])}else{a.push("")}}}return a}function pollToCSV(d){var a=window.screenPoll.style;if(!a){a={}}if(!d.style){d.style=a;if(!d.style){d.style={}}}if(window.user&&window.user.nm){d.style.owner=window.user.nm}for(var h in d.style){if(d.style[h]==window.defaultStyle[h]){delete d.style[h]}}if(!d.question){d.question=""}var g=d.options;var j=[];for(var e=0;e<g.length;e++){if(g[e]&&g[e][1]){j.push(g[e][1])}else{j.push(g)}}var a=JSON.stringify(d.style);var f=[d.question,JSON.stringify(j),a];var c=getUserArray(window.user);if(c.vt){c=JSON.stringify(c);f.push(c)}var b=CSV.stringify([f]);console.log("csv: "+b);return b}function parseData(b,c){if(!b){if(!c){error("e_votationRemoved");reset()}return false}else{if("null"==b){if(!c){error("e_connectionLost");reset()}return false}}var a;a=CSV.parse(b);return toObject(a)}function toObject(a){console.log(JSON.stringify(a));if(!$.isArray(a)){console.log("NOT ARRAY on "+JSON.stringify(a));return false}var c=a.shift();var f=a.shift();if(!f||!f.length){console.log("!options_arr || !options_arr.length");return false}var e=a.shift();var h={};for(var d=0;d<a.length;d++){var b=a[d];h[b[0]]=b}var g={question:c,style:e,users:h};parseOptions(g,f);return g}function parseOptions(c,a){var h=c.users;var j=[];for(var d=0;d<a.length;d++){if(!a[d]){break}j.push([d,a[d],0])}if(h&&h[1]&&"done"==h[1]["calc"]){for(var d=0;d<j.length;d++){var g=h[1][d];if(!g){g=0}j[d][2]=g}if(h[1]["vt"]){c.users[window.user.id][1]=h[1]["vt"]}}else{for(var b in h){if(!h[b][1]&&0!==h[b][1]){console.log(h[b]);continue}var f=voteArray(h[b][1]);for(var d=0;d<f.length;d++){var e=f[d];if(!j[e]){continue}j[e][2]++;if(!c.style||!c.style.multipleChoice){break}}}}c.options=j}function sortOptions(a){a.sort(function(d,c){return c[2]-d[2]||d[0]-c[0]});return a}function clickablePoll(c,e,a){var d=$(c);d.addClass("clickable");if(d.closest("#polls").hasClass("reduced")){d.addClass("hidden");var b=$(c).width()*0.314;d.css("max-height",b)}d.off(".event");d.on("click.event",function(f){if(!$(c).hasClass("clickable")){return}setTimeout(function(){if(d.hasClass("hidden")){d.css("max-height",(d.find("canvas, img").height()+50)+"px");d.removeClass("hidden");hidePollEvent(c,b);return}var g="http://"+settings.appPath+"/"+e;if(window.Device||window.localhost){g=location.href.split("#")[0].split("?")[0]+"#key="+e}location.href=g},1)})}function hidePollEvent(b,a){setTimeout(function(){$(document).one("click",function(c){if(!$(c.target).closest(b).length){$(b).addClass("hidden");$("#polls .image").css("max-height",a)}})},1)}function voteArray(a){if(null==a||"undefined"==typeof a){return[]}if("object"!=typeof a){if(a||0===a){a=[a]}else{a=[]}}return a}function wrapText(a,j,g,f,i,h,k){var o=1;var e=j.split(" ");var m="";for(var b=0;b<e.length;b++){var c=m+e[b]+" ";var d=a.measureText(c);var l=d.width;if(l>i&&b>0){if(!k){a.fillText(m,g,f)}m=e[b]+" ";f+=h;o++}else{m=c}}if(!k){a.fillText(m,g,f)}return o}function translateTags(a){if(window.lang&&!a){loadTranslations();return}if(!window.lang){window.lang={}}loadLanguage("~lang",function(){loadTranslations(a)})}function loadLanguage(b,c){var a=getUserLang();$.getScript(b+"/"+a+".js",function(){if(c){c()}}).fail(function(){console.log(b+" lang failed!");$.getScript(b+"/en.js",function(){if(c){c()}})})}function loadTranslations(a){if(!window.lang){return}$("[data-lang]").each(function(){var b=$(this).attr("data-lang");if($(this).text()&&!a&&$(this).text()!=b){return true}var c=window.lang[b];if(c){$(this).html(c)}else{$(this).html(b);console.log(b+" not have translation!")}});$("[data-placeholder]").each(function(){var b=$(this).attr("data-placeholder");var c=window.lang[b];if(c){$(this).attr("placeholder",c)}else{$(this).attr("placeholder",c);console.log(b+" not have translation!")}$(this).removeAttr("data-placeholder")})}function flash(b,a,d){$(document).off(".search");b+="";stopFlash();var c=$("<flash id='flash'>"+b+"</flash>");$("body").append(c);if(a){return}clearTimeout(window.flashTimeout);window.flashTimeout=setTimeout(function(){stopFlash(d)},500+b.length*50);setTimeout(function(){$(document).one("mousedown.search touchstart.search",function(){clearTimeout(window.flashTimeout);stopFlash(d)});$(".absoluteLoading").remove()},1);console.log("flash: "+b)}function stopFlash(a){if(a){a()}$("#flash").remove()}function noticePublic(){$("#linksLink").remove();var b=$("<div id='linksLink' class='clickable'>"+transl("PublicOnlyFromApp")+"</u></div>");$("#errorLog").append(b);$("#errorLog").show();var c="<div id=links class='hide'><div><img src='~commons/img/googleplay.png' onclick=\"location.href = '"+settings.androidURL+"'\"/></div><div><img src='~commons/img/appstore.png' class='disabled'/></div></div>";$("#linksLink").append(c);b.click(function(a){$(document).off(".links");$("#links").toggleClass("hide");setTimeout(function(){$(document).on("click.links",function(d){if(!$(d.target).closest("#links").length&&$(d.target).attr("id")!="links"){$(document).off(".links");$("#links").addClass("hide")}})},1)})}function noticeBrowser(){if(screenPoll.obj.style&&screenPoll.obj.style.onlyDevice&&!screenPoll.isPublic){disableVotation();notice(lang.onlyDevice)}}function modalInput(b,a,g){var e=$("<div id='modal_input'>");var d=$("<div>");d.append("<b style='line-height:50px; font-size: 18px;'>"+b+"</b>");var c=$("<input style='width:100%; text-align: center;' type='text' data-placeholder='myName' />");if(a){c.attr("value",a)}d.append(c);var f=$("<button style='width:100%'>");f.text(transl("Ok"));f.click(function(){if(g){g(c.val())}e.remove()});d.append(f);e.append(d);setTimeout(function(){e.css("opacity",1);d.css({"-webkit-transform":"translate(-50%, -64%)","-ms-transform":"translate(-50%, -64%)",transform:"translate(-50%, -64%)"})},100);$("body").append(e);c.focus()}function modalBox(a,f,e,d){$("#modal_box").remove();var c=$("<div id='modal_box'>");var b=$("<div id='modal_box_note'><p>"+a+"</p><button id='modal_ok'>"+transl("Ok")+"</button><br/><small>"+f+"</small><br/></div>");c.append(b);$("body").append(c);setTimeout(function(){$(document).on("click.modal",function(h){var g=$(h.target);if("modal_ok"==g.attr("id")){c.remove();$(document).off(".modal");if(e){e()}}else{if("modal_box_note"!=g.attr("id")&&!g.closest("#modal_box_note").length){c.remove();$(document).off(".modal");if(d){d()}}}});setTimeout(function(){c.css("opacity",1);b.css({"-webkit-transform":"translate(-50%, -64%)","-ms-transform":"translate(-50%, -64%)",transform:"translate(-50%, -64%)"})},100)},1)}function askPhone(a){if(window.phoneAlreadyAsked){error("e_phoneValidationNotWork")}modalBox(transl("needsPhone"),transl("needsPhoneComment"),function(){window.phoneAlreadyAsked=true;setTimeout(function(){if(Device.askPhone){Device.askPhone(a)}else{flash(transl("deprecatedVersion"))}},1)})}window.onerror=function(g,e,c,d,f){var b=!d?"":"\ncolumn: "+d;b+=!f?"":"\nerror: "+f;var a="; Error: "+g+"\nurl: "+e+"\nline: "+c+b+"; ";console.log(a,"from",f.stack);error(f.stack,arguments.callee.caller)};window.addEventListener("error",function(a){console.log(a.error.message,"from",a.error.stack)});function error(a,b){console.log(a+" - in error function");a+="";var c=transl(a).replace(/["']/g,"");notice("error: "+c,true);if($("#loading:visible").length){}if(!Device.error){$.post(settings.corePath+"error.php",{error:c})}else{Device.error(c)}}function notice(c,a){$("#errorLog").show();if(!c){c="unknown error"}var b=$("<div data-lang='"+c+"'>"+c+"</div>");$("#errorLog").append(b);return b}function pollsView(){}$(document).ready(function(){window.lastKeyAsk=0;$("#create").click(function(){console.log("CREATE");$("#errorLog").html("");if(!$("#options").val()){flash(transl("min1Option"));return}if(!checkConnection()){console.log("!checkConnection");return}window.lastKeyAsk++;window.fromCreateFunction=true;hashManager.update("new")});$("#firstOk").click(function(){if(Device.firstTimeOk){Device.firstTimeOk()}else{hashManager.update("home")}});$("#firstCreate").click(function(){hashManager.update("home")});textareaHeight=$(document).height()/2-180;var c=Math.max(Math.floor(textareaHeight/20),3);$("#options").attr("rows",c);var a=$("#options").attr("rows");var d=false;$("#options").keydown(function(g){if(d){var f=$(this).val().split("\n").length;if(f<=a){d=false;$("#errorLog").html("")}}if(g.keyCode==13){var f=$(this).val().split("\n").length;if(f>a){console.log(f+" > "+a);d=true;$("#errorLog").html(lang.onlyMostVotedShows).show()}}});$("#question").keydown(function(h){var f=$(this).attr("rows");var g=$(this).val().split("\n").length;if(h.keyCode==13&&g>=f){return false}});var b;$("#showPolls").on("tap",function(f){var g=$(this);f.preventDefault();$("#stored").toggleClass("hidden");if($("#stored").hasClass("hidden")){g.text(lang.showYourPolls);return}if(!b){loadStoredPolls();$("#stored").hide();$("#stored").css("height","auto");b=$("#stored").height();$("#stored").css("height",0);$("#stored").show()}setTimeout(function(){$("#stored").css("height",b+"px")},1);setTimeout(function(){g.text(lang.hidePolls);$("#stored").css("height","auto");$("#stored").css("height",$("#stored").css("height"))},300);$("#stored").show()});$("#toPolls").click(function(){hashManager.update("polls")});$("#newPoll").click(function(){hashManager.update("home")});if(is_touch_device()&&!$(".translucent").length){$(document).on("swiperight",function(f){hashManager.update("home")}).on("swipeleft",function(){if(!$("#p_menu").hasClass("p_show")&&!$("#body").hasClass("swiping")){hashManager.update("polls")}})}});var isoCountries={AF:{en:"Afghanistan"},AX:{en:"Aland Islands",es:"Islas Aland"},AL:{en:"Albania"},DZ:{en:"Algeria"},AS:{en:"American Samoa"},AD:{en:"Andorra"},AO:{en:"Angola"},AI:{en:"Anguilla",es:"Anguila"},AQ:{en:"Antarctica"},AG:{en:"Antigua and Barbuda",es:"Antigua y Barbuda"},AR:{en:"Argentina"},AM:{en:"Armenia"},AW:{en:"Aruba"},AU:{en:"Australia"},AT:{en:"Austria"},AZ:{en:"Azerbaijan"},BS:{en:"Bahamas"},BH:{en:"Bahrain"},BD:{en:"Bangladesh"},BB:{en:"Barbados"},BY:{en:"Belarus",es:"Bielorusia"},BE:{en:"Belgium"},BZ:{en:"Belize"},BJ:{en:"Benin"},BM:{en:"Bermuda"},BT:{en:"Bhutan"},BO:{en:"Bolivia"},BA:{en:"Bosnia and Herzegovina",es:"Bosnia Herzegovina"},BW:{en:"Botswana"},BV:{en:"Bouvet Island"},BR:{en:"Brazil",es:"Brasil"},IO:{en:"British Indian Ocean Territory"},BN:{en:"Brunei Darussalam"},BG:{en:"Bulgaria"},BF:{en:"Burkina Faso"},BI:{en:"Burundi"},KH:{en:"Cambodia"},CM:{en:"Cameroon"},CA:{en:"Canada",es:"Canad√°"},CV:{en:"Cape Verde"},KY:{en:"Cayman Islands"},CF:{en:"Central African Republic"},TD:{en:"Chad"},CL:{en:"Chile"},CN:{en:"China"},CX:{en:"Christmas Island"},CC:{en:"Cocos (Keeling) Islands"},CO:{en:"Colombia"},KM:{en:"Comoros"},CG:{en:"Congo"},CD:{en:"Congo Democratic Republic",es:"Rep√∫blica Democr√°tica del Congo"},CK:{en:"Cook Islands"},CR:{en:"Costa Rica"},CI:{en:"Cote d'Ivoire"},HR:{en:"Croatia",es:"Croacia"},CU:{en:"Cuba"},CY:{en:"Cyprus",es:"Chipre"},CZ:{en:"Czech Republic"},DK:{en:"Denmark",es:"Dinamarca"},DJ:{en:"Djibouti"},DM:{en:"Dominica"},DO:{en:"Dominican Republic",es:"Rep√∫blica Dominicana"},EC:{en:"Ecuador"},EG:{en:"Egypt",es:"Egipto"},SV:{en:"El Salvador"},GQ:{en:"Equatorial Guinea"},ER:{en:"Eritrea"},EE:{en:"Estonia"},ET:{en:"Ethiopia",es:"Etiop√≠a"},FK:{en:"Falkland Islands (Malvinas)"},FO:{en:"Faroe Islands",es:"Islas Faroe"},FJ:{en:"Fiji"},FI:{en:"Finland",es:"Finlanda"},FR:{en:"France",es:"Francia"},GF:{en:"French Guiana"},PF:{en:"French Polynesia"},TF:{en:"French Southern Territories"},GA:{en:"Gabon"},GM:{en:"Gambia"},GE:{en:"Georgia"},DE:{en:"Germany"},GH:{en:"Ghana"},GI:{en:"Gibraltar"},GR:{en:"Greece",es:"Grecia"},GL:{en:"Greenland"},GD:{en:"Grenada"},GP:{en:"Guadeloupe"},GU:{en:"Guam"},GT:{en:"Guatemala"},GG:{en:"Guernsey"},GN:{en:"Guinea"},GW:{en:"Guinea-Bissau"},GY:{en:"Guyana"},HT:{en:"Haiti",es:"Hait√≠"},HM:{en:"Heard Island & Mcdonald Islands"},VA:{en:"Holy See (Vatican City State)",es:"Ciudad del Vaticano"},HN:{en:"Honduras"},HK:{en:"Hong Kong"},HU:{en:"Hungary",es:"Hungr√≠a"},IS:{en:"Iceland",es:"Islandia"},IN:{en:"India"},ID:{en:"Indonesia"},IR:{en:"Iran",es:"Ir√°n"},IQ:{en:"Iraq"},IE:{en:"Ireland",es:"Irlanda"},IM:{en:"Isle Of Man",es:"Isla de Man"},IL:{en:"Israel"},IT:{en:"Italy",es:"Italia"},JM:{en:"Jamaica"},JP:{en:"Japan",es:"Jap√≥n"},JE:{en:"Jersey"},JO:{en:"Jordan"},KZ:{en:"Kazakhstan"},KE:{en:"Kenya",es:"Kenia"},KI:{en:"Kiribati"},KP:{en:"North Korea",es:"Corea del Norte"},KR:{en:"South Korea",es:"Corea del Sur"},KW:{en:"Kuwait"},KG:{en:"Kyrgyzstan"},LA:{en:"Lao People's Democratic Republic"},LV:{en:"Latvia"},LB:{en:"Lebanon"},LS:{en:"Lesotho"},LR:{en:"Liberia"},LY:{en:"Libyan Arab Jamahiriya",es:"Libia"},LI:{en:"Liechtenstein"},LT:{en:"Lithuania"},LU:{en:"Luxembourg"},MO:{en:"Macao"},MK:{en:"Macedonia"},MG:{en:"Madagascar"},MW:{en:"Malawi"},MY:{en:"Malaysia"},MV:{en:"Maldives"},ML:{en:"Mali"},MT:{en:"Malta"},MH:{en:"Marshall Islands"},MQ:{en:"Martinique"},MR:{en:"Mauritania"},MU:{en:"Mauritius"},YT:{en:"Mayotte"},MX:{en:"Mexico"},FM:{en:"Micronesia, Federated States Of"},MD:{en:"Moldova"},MC:{en:"Monaco",es:"M√≥naco"},MN:{en:"Mongolia"},ME:{en:"Montenegro"},MS:{en:"Montserrat"},MA:{en:"Morocco"},MZ:{en:"Mozambique"},MM:{en:"Myanmar"},NA:{en:"Namibia"},NR:{en:"Nauru"},NP:{en:"Nepal"},NL:{en:"Netherlands"},AN:{en:"Netherlands Antilles"},NC:{en:"New Caledonia"},NZ:{en:"New Zealand",es:"Nueva Zelanda"},NI:{en:"Nicaragua"},NE:{en:"Niger"},NG:{en:"Nigeria"},NU:{en:"Niue"},NF:{en:"Norfolk Island"},MP:{en:"Northern Mariana Islands"},NO:{en:"Norway"},OM:{en:"Oman"},PK:{en:"Pakistan"},PW:{en:"Palau"},PS:{en:"Palestinia",es:"Palestina"},PA:{en:"Panama"},PG:{en:"Papua New Guinea",es:"Papua Nueva Guinea"},PY:{en:"Paraguay"},PE:{en:"Peru",es:"Per√∫"},PH:{en:"Philippines",es:"Filipinas",},PN:{en:"Pitcairn"},PL:{en:"Poland",es:"Polonia"},PT:{en:"Portugal"},PR:{en:"Puerto Rico"},QA:{en:"Qatar"},RE:{en:"Reunion",es:"Reuni√≥n"},RO:{en:"Romania",es:"Ruman√≠a"},RU:{en:"Russian Federation",es:"Rusia"},RW:{en:"Rwanda"},BL:{en:"Saint Barthelemy"},SH:{en:"Saint Helena"},KN:{en:"Saint Kitts and Nevis",es:"Saint Kitts y Nevis"},LC:{en:"Saint Lucia"},MF:{en:"Saint Martin"},PM:{en:"Saint Pierre and Miquelon",es:"Saint Pierre y Miquelon"},VC:{en:"Saint Vincent and Grenadines",es:"Saint Vincent y Grenadines"},WS:{en:"Samoa"},SM:{en:"San Marino"},ST:{en:"Sao Tome and Principe",es:"Sao Tome y Principe"},SA:{en:"Saudi Arabia",es:"Arabia Saud√≠"},SN:{en:"Senegal"},RS:{en:"Serbia"},SC:{en:"Seychelles"},SL:{en:"Sierra Leone",es:"Sierra Leona"},SG:{en:"Singapore",es:"Singapur"},SK:{en:"Slovakia",es:"Eslovaquia"},SI:{en:"Slovenia",es:"Eslovenia"},SB:{en:"Solomon Islands",es:"Islas Solom√≥n"},SO:{en:"Somalia"},ZA:{en:"South Africa"},GS:{en:"South Georgia and Sandwich Isl.",es:"South Georgia y Sandwich Isl."},ES:{en:"Spain",es:"Espa√±a"},LK:{en:"Sri Lanka"},SD:{en:"Sudan"},SR:{en:"Suriname"},SJ:{en:"Svalbard and Jan Mayen",es:"Svalbard y Jan Mayen"},SZ:{en:"Swaziland"},SE:{en:"Sweden"},CH:{en:"Switzerland",es:"Suiza"},SY:{en:"Syrian Arab Republic",es:"S√≠ria"},TW:{en:"Taiwan"},TJ:{en:"Tajikistan"},TZ:{en:"Tanzania"},TH:{en:"Thailand",es:"Tailandia"},TL:{en:"Timor-Leste"},TG:{en:"Togo"},TK:{en:"Tokelau"},TO:{en:"Tonga"},TT:{en:"Trinidad and Tobago",es:"Trinidad y Tobago"},TN:{en:"Tunisia",es:"T√∫nez"},TR:{en:"Turkey",es:"Turqu√≠a"},TM:{en:"Turkmenistan"},TC:{en:"Turks and Caicos Islands",es:"Turks y Caicos Islands"},TV:{en:"Tuvalu"},UG:{en:"Uganda"},UA:{en:"Ukraine",es:"Ucrania"},AE:{en:"United Arab Emirates",es:"Emiratos √Årabes"},GB:{en:"United Kingdom",es:"Reino Unido"},US:{en:"United States",es:"Estados Unidos"},UM:{en:"United States Outlying Islands"},UY:{en:"Uruguay"},UZ:{en:"Uzbekistan"},VU:{en:"Vanuatu"},VE:{en:"Venezuela"},VN:{en:"Viet Nam"},VG:{en:"Virgin Islands, British",es:"Islas V√≠rgenes, Inglaterra"},VI:{en:"Virgin Islands, U.S.",es:"Islas V√≠rgenes, U.S."},WF:{en:"Wallis and Futuna",es:"Wallis y Futuna"},EH:{en:"Western Sahara",es:"S√°hara Occidental"},YE:{en:"Yemen"},ZM:{en:"Zambia"},ZW:{en:"Zimbabwe"},AC:{en:"Ascension"},TA:{en:"Tristan da Cunha"},ABH:{en:"Abkhazia"},EU:{en:"European Union (EU)",es:"Uni√≥n Europea (UE)"},UNASUR:{en:"UNASUR"}};function getCountryName(a,c){if(!a){console.log("error: not country code given");return false}if(!c){c="en"}if(isoCountries.hasOwnProperty(a.toUpperCase())){var b=isoCountries[a.toUpperCase()];if(b.hasOwnProperty(c)){return b[c]}else{if("en"!=c){if(b.hasOwnProperty("en")){return b.en}}}}return a};